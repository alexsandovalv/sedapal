<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<body>

	<!-- Modal activoModal-->
		
		  <div class="modal-dialog modal-lg" th:fragment="modalActivo">
		    <div class="modal-content">
		      <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">
					<span aria-hidden="true">&times;</span><span class="sr-only">Cerrar</span>
				</button>
				<h4 class="modal-title" id="titleModalLabel">
                    <strong><span th:text="${#strings.isEmpty(process)}?'Crear Activo':'Editar Activo'">Editar Activo</span></strong>
				</h4>
			</div>
		      <div class="modal-body" id="bodyForm">
		        <div class="container-fluid">
	        		<form class="form-horizontal" id="saveActivo" method="post" enctype="multipart/form-data" 
	        				th:action="${#strings.isEmpty(process)}?@{'/activo/save/new/'}:@{'/activo/save/'+${codigoEditable}+'/edit/'}"
	        				th:object="${activo}">
	       				<input type="hidden" th:field="*{cuenta_contable}" />
	       				<input type="hidden" id="denominacionClase" th:field="*{denominacion_clase}" />
	       				<input type="hidden" id="activoSedapal" name="activo_sedapal" />
	       			
	        			<div class="col-xs-12 col-md-6">
							<div class="form-group">
								<label for="cboclases" class="col-sm-4 control-label">Clase</label>
								<div class="col-sm-8">
									<select id="cboclases" class="form-control cmbclase" th:field="*{clase}">
										<option value="">Seleccione</option>
									</select>
									
								</div>																
							</div>
							<div class="form-group">
								<label for="txtSeq2015" class="col-sm-4 control-label">Seq 2015</label>
								<div class="col-sm-8">
									<input type="text" id="txtSeq2015" class="form-control" th:field="*{seq2015}" 
										placeholder="Ingrese seq2015" required="required" maxlength="6"/>
								</div>																
							</div>
							<div class="form-group">
								<label for="txtSeq2013" class="col-sm-4 control-label">Seq 2013</label>
								<div class="col-sm-8">
									<input type="text" id="txtSeq2013" class="form-control" th:field="*{secuencial}" 
										placeholder="Ingrese seq2013" required="required" maxlength="6"/>
								</div>																
							</div>
							<div class="form-group">
								<label for="txtMarca" class="col-sm-4 control-label">Marca</label>
								<div class="col-sm-8">
									<input type="text" id="txtMarca" class="form-control" th:field="*{marca}" 
										placeholder="Ingrese Marca" required="required"/>
								</div>																
							</div>
							<div class="form-group">
								<label for="txtSerie" class="col-sm-4 control-label">Serie</label>
								<div class="col-sm-8">
									<input type="text" id="txtSerie" class="form-control" th:field="*{nro_serie}" 
										placeholder="Ingrese Serie" required="required"/>
								</div>																
							</div>
							<div class="form-group">
								<label for="txtModelo" class="col-sm-4 control-label">Modelo</label>
								<div class="col-sm-8">
									<input type="text" id="txtModelo" class="form-control" th:field="*{modelo}" 
										placeholder="Ingrese Modelo" required="required"/>
								</div>																
							</div>
	
	        			</div>
	
	        			<div class="col-xs-12 col-md-6">
							<div class="form-group">
								<label for="txtActivo" class="col-sm-4 control-label">Codigo de Activo</label>
								<div class="col-sm-8">
									<input type="text" id="txtActivo" class="form-control" th:field="*{activo}" 
										placeholder="" readonly="readonly"/>
								</div>																
							</div>
							<div class="form-group">
								<label for="txtDenoCoac" class="col-sm-4 control-label">Denominacion</label>
								<div class="col-sm-8">
									<input type="text" id="txtDenoCoac" class="form-control" th:field="*{nombre_denominacon}" 
										placeholder="Ingrese Denominacion" required="required"/>
								</div>																
							</div>
							<div class="form-group">
								<label for="txtColor" class="col-sm-4 control-label">Color</label>
								<div class="col-sm-8">
									<input type="text" id="txtColor" class="form-control" th:field="*{color}" 
										placeholder="Ingrese Color" required="required"/>
								</div>																
							</div>
							<div class="form-group">
								<label for="txtEstconserva" class="col-sm-4 control-label">Estado Conservación</label>
								<div class="col-sm-8">
									<select id="txtEstconserva" class="form-control" th:field="*{estado_conservacion}"
											required="required">
										<option value="">Seleccione</option>
								    	<option value="10">10 Muy Bueno</option>
								    	<option value="11">11 Bueno</option>
								    	<option value="12">12 Regular</option>
								    	<option value="13">13 Malo</option>
								    	<option value="14">14 Muy Malo</option>
								    </select>
								</div>																
							</div>
							<div class="form-group">
								<label for="txtOperatividad" class="col-sm-4 control-label">Operatividad</label>
								<div class="col-sm-8">
									<select class="form-control" id="txtOperatividad" th:field="*{operatividad}">
										<option value="">Seleccione</option>
								    	<option value="O">Operativo</option>
										<option value="I">Inoperativo</option>
								    </select>
								</div>																
							</div>
							<div class="form-group has-error">
								<label for="txtFolio" class="col-sm-4 control-label">Número Folio</label>
								<div class="col-sm-8">
									<input type="text" id="txtFolio" class="form-control inputNumber" th:field="*{numero_folio}" maxlength="6"
										placeholder="Ingrese Folio" required="required"/>
								</div>																
							</div>
	        			</div>
	
	        			<div class="col-xs-12 col-md-12">
							<div class="form-group">
								<label for="txtObservaciones" class="col-sm-2 control-label">Observaciones</label>
								<div class="col-sm-10">
									<textarea id="txtObservaciones" class="form-control" rows="3" th:field="*{observacion}"
										required="required"></textarea>
								</div>
							</div>
	        			</div>
	        			
	        			<div class="col-xs-12 col-md-12">
	        				<div th:replace="fragment/divPhotos :: photos"></div>
						</div>
									  
					</form>	        	
		        </div>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-primary" id="btnGuardar">Guardar</button>
		        <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
		      </div>
		    </div>
		    
		    <script th:inline="javascript">
		    
		    $(function(){
		    	// <![CDATA[
		    	$(".inputNumber").keydown(
		    		function(event) {
		    			if (event.keyCode == 46 || event.keyCode == 8
		    					|| event.keyCode == 9 || event.keyCode == 37
		    					|| event.keyCode == 38 || event.keyCode == 39
		    					|| event.keyCode == 40 || event.keyCode == 13) {
		    				// let it happen, don't do anything
		    			} else if ((event.shiftKey || (event.keyCode < 48 || event.keyCode > 57)) 
		    					&& (event.keyCode < 96 || event.keyCode > 105)) {
		    				event.preventDefault();
		    			}
		    		});
		    	// ]]>
		    	
				// <![CDATA[
				            
				    $('input[type=text]', '#saveActivo').attr('required','required');
					$('select', '#saveActivo').attr('required','required');
					$('input[type=text][readonly]', '#saveActivo').removeAttr('readonly');
					$("#txtActivo", '#saveActivo').removeAttr('required');
					$("#txtActivo", '#saveActivo').attr("readonly","readonly");
					$("#activoSedapal").val($("#tmpCodigo").val());
				    var anexo = $("#anexo").val();
				    var url = /*[[@{/activo/util/anexos/}]]*/
				    url = url+ anexo;
				    var clase = /*[[${activo.clase}]]*/
				    
				    $.getJSON(url).done(function(data){
				    	$.each(data, function(){
				    		var option = $('<option />');
				    		option.attr('value', this.clase).text(this.denominacion);
				    		if(clase == this.clase)
				    			option.attr('selected','selected')
				    		$("#cboclases").append(option);
				    	});
				    });
				    
				    
				    $("#btnGuardar").click(function(event){
			    		event.preventDefault();
			    		$("#divAlert").remove();
				    	/* $("#saveActivo").each(function(){
				    	    var input = $(this).find(':input');
				    	    if($.trim( $(input).val())) {
				    	    	$(input).focus();
				    	    }
				    	}); */
				    	
				    	console.log("click en guardar showActivo....");
				    	
				    	var formURL = $("#saveActivo").attr("action");
			    		var postData = new FormData($("#saveActivo")[0]);
			    		//$("#saveActivo").serializeArray();
			    		/* var postData = new FormData();
			    		jQuery.each(jQuery('#saveActivo')[0].file, function(i, file) {
			    			postData.append('file-'+i, file);
			    		}); */
			    		console.log("action => "+formURL+anexo);
			    		console.log("Serialize => "+postData);
			    		$.ajax({
			    			type : 'POST',
			    			url : formURL+anexo,
			    			data : postData,
			    			mimeType:"multipart/form-data",
			    			async: false,
			    		    cache: false,
			    		    contentType: false,
			    		    processData: false
			    		})
			    			.done(function(response) {
			    				$("#activoModal").modal('hide');
	                            $('body').removeClass('modal-open');
	                            $('.modal-backdrop').remove();
	                            $("#itemActivos").html(response);
			    			})
			    			.error(function(xhr){
			    				console.log('status: ' + xhr.status);
			    				console.log('responseText: ' + xhr.responseText);
			    				
			    				var textPhoto = '&nbsp;El archivo a excedido el máximo permitido de 5MB.'
			    				var spanAlert = $("<span></span>").addClass("glyphicon glyphicon-exclamation-sign").attr("aria-hidden","true");
	    						var divText = $("<div></div>").addClass('alert alert-warning text-center').attr({role:"alert", id:"divAlert"})
	    														.html(spanAlert).append(textPhoto);
	    						
	    						$("#bodyForm").append(divText);
			    				
			    			});
			    		
				    });
				            
				// ]]>
		    });
		    
		    
		</script>
		    
		  </div>
		
		<!-- End activoModal -->
		
		
		
</body>
</html>